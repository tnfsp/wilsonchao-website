# Code Audit 報告：文章排版與 Notion 區塊樣式

**審查時間**: 2026-01-16 14:00
**審查範圍**: wilsonchao.com 文章排版系統
**檔案數量**: 3 個核心檔案

---

## 問題總覽

| 等級 | 數量 |
|------|------|
| Critical | 1 |
| Warning | 5 |
| Info | 3 |

---

## Notion 區塊支援狀況

### sync-notion.ts 支援的區塊類型

| 區塊類型 | HTML 輸出 | CSS 樣式 | 狀態 |
|----------|-----------|----------|------|
| heading_1 | `<h1>` | ✅ 有 | 正常 |
| heading_2 | `<h2>` | ✅ 有 | 正常 |
| heading_3 | `<h3>` | ✅ 有 | 正常 |
| paragraph | `<p>` | ✅ 有 | 正常 |
| bulleted_list | `<ul><li>` | ✅ 有 | 正常 |
| numbered_list | `<ol><li>` | ✅ 有 | 正常 |
| quote | `<blockquote>` | ⚠️ 基本 | 需改進 |
| callout | `<blockquote>` | ⚠️ 無區分 | 需改進 |
| divider | `<hr>` | ✅ 有 | 正常 |
| image | `<figure><img>` | ✅ 有 | 正常 |
| figcaption | `<figcaption>` | ❌ 無 | 缺失 |
| code | `<pre><code>` | ⚠️ 基本 | 需改進 |
| inline code | `<code>` | ❌ 無區分 | 缺失 |
| toggle | `<details><summary>` | ❌ 無 | 缺失 |
| to_do | `.notion-todo` | ❌ 無 | 缺失 |
| table | `<table>` | ❌ 無 | 缺失 |

---

## Critical 問題

### 1. 行內程式碼 (inline code) 沒有樣式區分

- **位置**: `app/globals.css:205-207`
- **問題**: 目前 `.prose code` 只設定了 `font-size`，沒有背景色或邊框，導致行內程式碼在段落中不明顯
- **影響**: 文章中提到的程式碼片段（如變數名、指令）難以辨識

**目前樣式**:
```css
.prose code {
  font-size: 0.875em;
}
```

**建議修復**:
```css
/* 行內程式碼 */
.prose code {
  font-size: 0.875em;
  background: rgba(0, 18, 25, 0.06);
  padding: 0.2em 0.4em;
  border-radius: 4px;
  font-family: var(--font-mono);
}

/* 程式碼區塊內的 code 不需要背景 */
.prose pre code {
  background: transparent;
  padding: 0;
  border-radius: 0;
}
```

---

## Warning 問題

### 1. 圖片說明 (figcaption) 沒有樣式

- **位置**: `app/globals.css` (缺失)
- **問題**: `<figcaption>` 沒有任何樣式，顯示為預設文字
- **影響**: 圖片說明與正文混淆，無法區分

**建議新增**:
```css
.prose figcaption {
  margin-top: 0.75em;
  font-size: 0.875em;
  color: var(--muted);
  text-align: center;
}
```

---

### 2. 摺疊區塊 (details/summary) 沒有樣式

- **位置**: `app/globals.css` (缺失)
- **問題**: Notion 的 toggle 區塊轉成 `<details><summary>`，但沒有樣式
- **影響**: 摺疊區塊看起來很陽春，與整體設計不協調

**建議新增**:
```css
.prose details {
  margin-top: 1.25em;
  margin-bottom: 1.25em;
  border: 1px solid var(--border);
  border-radius: 8px;
  overflow: hidden;
}

.prose summary {
  padding: 0.75em 1em;
  background: rgba(0, 18, 25, 0.03);
  cursor: pointer;
  font-weight: 500;
}

.prose summary:hover {
  background: rgba(0, 18, 25, 0.06);
}

.prose details[open] summary {
  border-bottom: 1px solid var(--border);
}

.prose details > *:not(summary) {
  padding: 0 1em;
}
```

---

### 3. 表格 (table) 沒有樣式

- **位置**: `app/globals.css` (缺失)
- **問題**: 雖然目前沒有使用表格，但 sync-notion.ts 支援表格，應預先準備樣式
- **影響**: 未來使用表格時會顯示為預設樣式，破壞整體設計

**建議新增**:
```css
.prose table {
  width: 100%;
  margin-top: 1.5em;
  margin-bottom: 1.5em;
  border-collapse: collapse;
  font-size: 0.9em;
}

.prose th,
.prose td {
  padding: 0.75em 1em;
  border: 1px solid var(--border);
  text-align: left;
}

.prose th {
  background: rgba(0, 18, 25, 0.03);
  font-weight: 600;
}

.prose tr:hover {
  background: rgba(0, 18, 25, 0.02);
}
```

---

### 4. 待辦事項 (notion-todo) 沒有樣式

- **位置**: `app/globals.css` (缺失)
- **問題**: Notion 的 to_do 區塊有專屬 class `.notion-todo`，但沒有樣式

**建議新增**:
```css
.prose .notion-todo {
  display: flex;
  align-items: flex-start;
  gap: 0.5em;
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

.prose .notion-todo input[type="checkbox"] {
  margin-top: 0.3em;
  accent-color: var(--accent);
}

.prose .notion-todo label {
  display: flex;
  align-items: flex-start;
  gap: 0.5em;
}
```

---

### 5. Callout 與 Quote 無法區分

- **位置**: `scripts/sync-notion.ts:382-392`
- **問題**: Callout 和 Quote 都轉成 `<blockquote>`，無法區分樣式
- **影響**: Callout（通常有 emoji 圖標，用於重點提示）和 Quote（引用）視覺上相同

**建議修復** (sync-notion.ts):
```typescript
case "callout": {
  const icon = block.callout.icon?.type === "emoji"
    ? `<span class="callout-icon">${block.callout.icon.emoji}</span>`
    : "";
  html = `<div class="notion-callout">${icon}<div class="callout-content">${toHtml(block.callout.rich_text)}${renderedChildren.html}</div></div>`;
  break;
}
```

**建議新增 CSS**:
```css
.prose .notion-callout {
  display: flex;
  gap: 0.75em;
  margin-top: 1.5em;
  margin-bottom: 1.5em;
  padding: 1em;
  background: rgba(10, 147, 150, 0.08);
  border-radius: 8px;
  border-left: 3px solid var(--accent);
}

.prose .notion-callout .callout-icon {
  font-size: 1.25em;
  line-height: 1;
}

.prose .notion-callout .callout-content {
  flex: 1;
}

.prose .notion-callout p:first-child {
  margin-top: 0;
}

.prose .notion-callout p:last-child {
  margin-bottom: 0;
}
```

---

## Info 建議

### 1. blockquote 樣式可以更精緻

- **位置**: `app/globals.css:178-185`
- **建議**: 目前的引用區塊只有左邊框線，可以加上背景色讓它更突出

```css
.prose blockquote {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
  padding: 1em 1em 1em 1.25em;
  border-left: 3px solid var(--accent);
  background: rgba(0, 18, 25, 0.02);
  border-radius: 0 8px 8px 0;
  font-style: italic;
  color: var(--muted);
}

.prose blockquote p:first-child {
  margin-top: 0;
}

.prose blockquote p:last-child {
  margin-bottom: 0;
}
```

---

### 2. 程式碼區塊可加入語言標籤

- **位置**: `app/globals.css:196-203`
- **建議**: 顯示程式碼的語言名稱，提升可讀性

```css
.prose pre {
  position: relative;
  margin-top: 1.5em;
  margin-bottom: 1.5em;
  padding: 1.25em 1em;
  background: #1e1e1e;
  border-radius: 8px;
  overflow-x: auto;
}

.prose pre::before {
  content: attr(data-language);
  position: absolute;
  top: 0;
  right: 0;
  padding: 0.25em 0.75em;
  font-size: 0.75em;
  color: rgba(255, 255, 255, 0.5);
  background: rgba(255, 255, 255, 0.1);
  border-radius: 0 8px 0 8px;
}

.prose pre code {
  color: #d4d4d4;
  font-family: var(--font-mono);
  line-height: 1.6;
}
```

*註：需要同時修改 sync-notion.ts，在 `<pre>` 加上 `data-language` 屬性*

---

### 3. 圖片可加入陰影和最大寬度限制

- **位置**: `app/globals.css:192-194`
- **建議**: 讓圖片更有層次感

```css
.prose figure {
  margin-top: 2em;
  margin-bottom: 2em;
}

.prose img {
  max-width: 100%;
  height: auto;
  border-radius: 8px;
  box-shadow: 0 4px 20px rgba(0, 18, 25, 0.1);
}
```

---

## 總結

### 整體評價

目前的文章排版系統架構良好，sync-notion.ts 已經支援大部分常用的 Notion 區塊類型。主要問題是 **CSS 樣式覆蓋不完整**，導致部分區塊（特別是 figcaption、details、table、inline code）使用瀏覽器預設樣式，與整體設計不協調。

### 優先處理建議

1. **Critical**: 行內程式碼樣式 - 影響所有有程式碼片段的文章
2. **Warning**: figcaption 樣式 - 已經有文章在使用
3. **Warning**: details/summary 樣式 - 已經有文章在使用 (meshstatic)
4. **Warning**: Callout 區分 - 需修改 sync-notion.ts + CSS
5. **Warning**: 表格樣式 - 預防性準備
6. **Warning**: 待辦事項樣式 - 預防性準備

### 做得好的地方

1. 已經使用 CSS 變數系統，方便統一調整顏色
2. prose 樣式結構清晰，容易擴展
3. sync-notion.ts 的區塊處理邏輯完整，支援巢狀結構
4. 已經有 Prism.js 語法高亮支援
5. 整體視覺風格一致、優雅

---

## 快速修復清單

如果要一次性修復所有問題，以下是需要新增到 `app/globals.css` 的完整 CSS：

```css
/* ============================================
   Notion 區塊完整樣式
   ============================================ */

/* 行內程式碼 */
.prose code {
  font-size: 0.875em;
  background: rgba(0, 18, 25, 0.06);
  padding: 0.2em 0.4em;
  border-radius: 4px;
  font-family: var(--font-mono);
}

.prose pre code {
  background: transparent;
  padding: 0;
  border-radius: 0;
}

/* 圖片說明 */
.prose figcaption {
  margin-top: 0.75em;
  font-size: 0.875em;
  color: var(--muted);
  text-align: center;
}

/* 摺疊區塊 */
.prose details {
  margin-top: 1.25em;
  margin-bottom: 1.25em;
  border: 1px solid var(--border);
  border-radius: 8px;
  overflow: hidden;
}

.prose summary {
  padding: 0.75em 1em;
  background: rgba(0, 18, 25, 0.03);
  cursor: pointer;
  font-weight: 500;
  list-style: none;
}

.prose summary::-webkit-details-marker {
  display: none;
}

.prose summary::before {
  content: "▶";
  display: inline-block;
  margin-right: 0.5em;
  font-size: 0.75em;
  transition: transform 0.2s;
}

.prose details[open] summary::before {
  transform: rotate(90deg);
}

.prose summary:hover {
  background: rgba(0, 18, 25, 0.06);
}

.prose details[open] summary {
  border-bottom: 1px solid var(--border);
}

.prose details > *:not(summary) {
  padding: 0 1em;
}

/* 表格 */
.prose table {
  width: 100%;
  margin-top: 1.5em;
  margin-bottom: 1.5em;
  border-collapse: collapse;
  font-size: 0.9em;
}

.prose th,
.prose td {
  padding: 0.75em 1em;
  border: 1px solid var(--border);
  text-align: left;
}

.prose th {
  background: rgba(0, 18, 25, 0.03);
  font-weight: 600;
}

.prose tr:hover {
  background: rgba(0, 18, 25, 0.02);
}

/* 待辦事項 */
.prose .notion-todo {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

.prose .notion-todo label {
  display: flex;
  align-items: flex-start;
  gap: 0.5em;
  cursor: pointer;
}

.prose .notion-todo input[type="checkbox"] {
  margin-top: 0.35em;
  accent-color: var(--accent);
}

/* 改進的 blockquote */
.prose blockquote {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
  padding: 1em 1em 1em 1.25em;
  border-left: 3px solid var(--accent);
  background: rgba(0, 18, 25, 0.02);
  border-radius: 0 8px 8px 0;
  font-style: italic;
  color: var(--muted);
}

.prose blockquote p:first-child {
  margin-top: 0;
}

.prose blockquote p:last-child {
  margin-bottom: 0;
}
```

---

**報告完成**。如需修復這些問題，請確認後我可以協助實作。
